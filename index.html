<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>医生报告评估任务入口</title>
  <link rel="stylesheet" href="web/styles.css" />
  <script defer src="web/app.js"></script>
  <script defer src="web/segment.js"></script>
  <script defer src="web/storage.js"></script>
  <script defer src="web/export.js"></script>
  <style>
    /* small inline safety in case styles.css not loaded */
    .hidden{display:none}
  </style>
  <noscript>需要启用 JavaScript 才能使用该页面。</noscript>
</head>
<body>
  <main>
    <header class="page-header">
      <h1>医生侧评估任务面板</h1>
      <p>共 <span id="totalCount">0</span> 个任务，已按照分级比例划分为 3 组。</p>
    </header>

    <!-- 操作流程指南 -->
    <section class="card guide-card">
      <details class="guide-details">
        <summary class="guide-summary" title="点击展开或收起操作指南">
          <span class="guide-icon">📖</span>
          <span class="guide-title">操作流程指南</span>
          <span class="guide-hint">点击查看详细步骤 ▼</span>
        </summary>
        <div class="guide-content">
          <div class="guide-step">
            <h3>① 选择任务组</h3>
            <p>使用下方下拉菜单选择第 1/2/3 组，系统已按风险等级均衡分配任务。</p>
          </div>
          
          <div class="guide-step">
            <h3>② 打开报告 → 填写问卷</h3>
            <ul>
              <li>点击 <strong>"打开报告"</strong> 查看 AI 生成的患者报告</li>
              <li>仔细阅读后，点击 <strong>"去填写问卷"</strong></li>
              <li>完成 15 个评估问题（12 个打分题 + 3 个单选题）</li>
            </ul>
          </div>

          <div class="guide-step">
            <h3>③ 评分标准参考</h3>
            <div class="guide-scale">
              <span class="scale-item">1-3 分：明显低于平时</span>
              <span class="scale-item">4-5 分：符合平时水平</span>
              <span class="scale-item">6-7 分：略高于平时</span>
              <span class="scale-item">8-10 分：显著优于平时</span>
            </div>
          </div>

          <div class="guide-step">
            <h3>④ 保存与上传</h3>
            <ul>
              <li>问卷会自动保存到浏览器本地（已填写任务显示绿色标记）</li>
              <li><strong class="highlight">重要：</strong>完成一批任务后点击 <strong>"上传问卷到云端"</strong></li>
              <li>建议：定期点击 <strong>"导出为 JSON"</strong> 备份数据</li>
            </ul>
          </div>

          <div class="guide-step guide-warning">
            <h3>⚠️ 注意事项</h3>
            <ul>
              <li>清空浏览器缓存会丢失本地数据，务必先上传</li>
              <li>换电脑前先导出 JSON 文件</li>
              <li>每天结束前建议上传一次</li>
            </ul>
          </div>

          <div class="guide-workflow">
            <h3>🔄 完整流程</h3>
            <div class="workflow-steps">
              <span class="workflow-arrow">选择任务组</span>
              <span class="workflow-arrow">打开报告</span>
              <span class="workflow-arrow">填写问卷</span>
              <span class="workflow-arrow">保存</span>
              <span class="workflow-arrow">上传云端</span>
              <span class="workflow-final">✓ 完成</span>
            </div>
          </div>
        </div>
      </details>
    </section>

    <section class="card">
      <div class="controls">
        <div>
          <label for="partSelect">选择任务分组：</label>
          <select id="partSelect">
            <option value="1">第 1 组</option>
            <option value="2">第 2 组</option>
            <option value="3">第 3 组</option>
          </select>
        </div>
        <button id="reloadSeg">重新分配三等分比例</button>
      </div>
      <div class="stats">
        <span id="typeStats">分布：-</span>
        <span id="partStats">分组：-</span>
      </div>
      <div class="controls extra-controls">
        <button id="uploadAll">上传问卷到云端</button>
        <button id="exportJson">导出为 JSON</button>
        <button id="clearAll">清空本地保存</button>
        <span id="uploadStatus" class="status-text">未上传</span>
      </div>
    </section>

    <section class="card">
      <h2 style="margin-top:0;">当前分组任务</h2>
      <ol id="taskList"></ol>
    </section>

    <footer style="text-align:center;color:var(--muted);margin-top:28px;font-size:13px;">
      打开“报告”后回到此页填写问卷，所有问卷草稿会保存于本地；点击“上传”可同步到 Netlify。
    </footer>
  </main>
</body>
<!--
  For best results, open via a local HTTP server to avoid file:// CORS.
  Example: use VS Code Live Server or `python -m http.server`.
-->
</html>
